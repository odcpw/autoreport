<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AutoBericht Minimal Chapter Editor</title>
  <link rel="stylesheet" href="shared/ui.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="app-switcher">
        <a class="app-switcher__item is-active" href="./index.html">AutoBericht</a>
        <a class="app-switcher__item" href="./photosorter.html">PhotoSorter</a>
      </div>
      <div class="actions">
        <button id="open-settings" class="ghost" title="Settings">⚙</button>
        <button id="pick-folder">Open Project Folder</button>
        <button id="save-sidecar" disabled>Save sidecar</button>
      </div>
    </header>

    <section class="status" id="status"></section>

    <div class="layout">
      <aside class="sidebar">
        <h2>Chapters</h2>
        <nav id="chapter-list"></nav>
        <div class="filters">
          <label><input type="radio" name="filter-mode" value="all" checked /> Show all</label>
          <label><input type="radio" name="filter-mode" value="hide-yes" /> Hide answered yes</label>
          <label><input type="radio" name="filter-mode" value="include-only" /> Show include only</label>
          <label><input type="radio" name="filter-mode" value="done-only" /> Show done only</label>
          <label><input type="radio" name="filter-mode" value="hide-done" /> Hide done only</label>
        </div>
      </aside>

      <main class="content">
        <div id="chapter-title" class="chapter-title"></div>
        <div id="rows"></div>
      </main>
    </div>

    <div class="modal" id="settings-modal" aria-hidden="true">
      <div class="modal__backdrop" id="settings-close"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="modal__header">
          <h3 id="settings-title">Settings</h3>
          <button id="close-settings" type="button" class="modal__close" aria-label="Close settings">×</button>
        </div>
        <div class="modal__body">
          <div class="settings-body">
            <label>
            Moderator name
              <input id="settings-moderator" type="text" placeholder="Moderator" />
            </label>
            <label>
            Moderator initials
              <input id="settings-moderator-initials" type="text" placeholder="PM1" />
            </label>
            <label>
            Co-moderator name
              <input id="settings-co-moderator" type="text" placeholder="Co-Moderator" />
            </label>
            <label>
            Co-moderator initials
              <input id="settings-co-initials" type="text" placeholder="PM2" />
            </label>
            <label>
            Company name
              <input id="settings-company" type="text" placeholder="Company" />
            </label>
            <label>
            Company ID / number
              <input id="settings-companyid" type="text" placeholder="ID" />
            </label>
            <label>
            Report language
              <select id="settings-locale">
                <option value="de-CH">DE</option>
                <option value="fr-CH">FR</option>
                <option value="it-CH">IT</option>
              </select>
            </label>
            <label>
            Auto-backup (minutes)
              <input id="settings-backup-minutes" type="number" min="0" step="1" placeholder="30" />
            </label>
            <div class="settings-hint" id="settings-library-hint"></div>
          </div>
          <div class="modal__actions settings-actions">
            <button id="import-self" type="button" disabled>Import Selbstbeurteilung</button>
            <button id="open-spider" type="button" class="ghost" disabled>Edit Spider</button>
            <button id="save-log" type="button" class="ghost">Save debug log</button>
          </div>
          <div class="modal__actions">
            <button id="generate-library" type="button">Generate / Update Library</button>
            <button id="save-settings" type="button" class="ghost">Save settings</button>
          </div>
        </div>
      </div>
    </div>

    <div class="photo-overlay" id="photo-overlay" aria-hidden="true">
      <div class="photo-overlay__backdrop" id="photo-overlay-close"></div>
      <div class="photo-overlay__panel" role="dialog" aria-modal="true" aria-labelledby="photo-overlay-title">
        <div class="photo-overlay__header">
          <div class="photo-overlay__meta" id="photo-overlay-title"></div>
          <button type="button" class="ghost" id="photo-overlay-close-btn">✕</button>
        </div>
        <div class="photo-overlay__body">
          <button type="button" class="ghost" id="photo-overlay-prev">Prev (A)</button>
          <div class="photo-overlay__image">
            <img id="photo-overlay-image" alt="Selected photo preview" />
          </div>
          <button type="button" class="ghost" id="photo-overlay-next">Next (D)</button>
        </div>
      </div>
    </div>

    <div class="checklist-overlay" id="checklist-overlay" aria-hidden="true">
      <div class="checklist-overlay__backdrop" id="checklist-overlay-close"></div>
      <div class="checklist-overlay__panel" role="dialog" aria-modal="true" aria-labelledby="checklist-overlay-title">
        <div class="checklist-overlay__header">
          <div class="checklist-overlay__meta" id="checklist-overlay-title"></div>
          <button type="button" class="ghost" id="checklist-overlay-close-btn">✕</button>
        </div>
        <div class="checklist-overlay__body">
          <div class="checklist-overlay__hint" id="checklist-overlay-hint"></div>
          <div class="checklist-search">
            <input id="checklist-search" type="search" placeholder="Search checklists..." aria-label="Search checklists" />
          </div>
          <div class="checklist-overlay__filters" id="checklist-filters"></div>
          <div class="checklist-overlay__list" id="checklist-list"></div>
        </div>
      </div>
    </div>

    <div class="modal" id="spider-modal" aria-hidden="true">
      <div class="modal__backdrop" id="spider-close"></div>
      <div class="modal__content modal__content--wide" role="dialog" aria-modal="true" aria-labelledby="spider-title">
        <div class="modal__header">
          <h3 id="spider-title">Spider Overrides (Kapitelwerte)</h3>
          <button id="spider-close-btn" type="button" class="modal__close" aria-label="Close spider overrides">×</button>
        </div>
        <div class="modal__body">
          <div class="spider-hint">Basiswerte werden aus Antworten und Gewichten berechnet. Optional kannst du Kapitelwerte überschreiben.</div>
          <div class="spider-table-wrapper">
            <table class="spider-table">
              <thead>
                <tr>
                  <th>Kapitel</th>
                  <th>Company % (berechnet)</th>
                  <th>Override</th>
                  <th>Use</th>
                  <th>Consultant % (berechnet)</th>
                  <th>Override</th>
                  <th>Use</th>
                </tr>
              </thead>
              <tbody id="spider-table-body"></tbody>
            </table>
          </div>
        </div>
        <div class="modal__actions">
          <button id="spider-save" type="button">Save overrides</button>
          <button id="spider-cancel" type="button" class="ghost">Cancel</button>
        </div>
      </div>
    </div>

    <div class="modal" id="first-run-modal" aria-hidden="true">
      <div class="modal__backdrop"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="first-run-title">
        <div class="modal__header">
          <h3 id="first-run-title">Select project folder</h3>
        </div>
        <div class="modal__body">
          <p>Pick the project folder to start. This folder will store the project_sidecar.json file.</p>
          <div class="modal__actions">
            <button id="first-run-pick" type="button">Open Project Folder</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="library-modal" aria-hidden="true">
      <div class="modal__backdrop"></div>
      <div class="modal__content" role="dialog" aria-modal="true" aria-labelledby="library-title">
        <div class="modal__header">
          <h3 id="library-title">Choose a library</h3>
        </div>
        <div class="modal__body">
          <p>Multiple library files were found. Pick the one that matches this project.</p>
          <div class="library-list" id="library-list"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="../libs/sheetjs/xlsx.full.min.js"></script>
  <script src="../shared/debug-log.js"></script>
  <script src="shared/i18n.js"></script>
  <script src="shared/markdown.js"></script>
  <script src="shared/fs-handle.js"></script>
  <script src="shared/state.js"></script>
  <script src="shared/normalize.js"></script>
  <script src="shared/seeds.js"></script>
  <script src="shared/spider.js"></script>
  <script src="shared/spider-ui.js"></script>
  <script src="shared/io-sidecar.js"></script>
  <script src="shared/import-self.js"></script>
  <script src="shared/render.js"></script>
  <script src="shared/elements.js"></script>
  <script src="shared/bind-events.js"></script>
  <script src="app.js"></script>
</body>
</html>
